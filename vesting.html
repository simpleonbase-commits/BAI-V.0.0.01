<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BAI Vesting Terminal | Bureau of Agent Investigations</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: #0a0a0f;
            color: #e0e0e0;
            min-height: 100vh;
            line-height: 1.6;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 40px 20px;
            border-bottom: 1px solid #1a1a2e;
            margin-bottom: 40px;
        }
        
        .logo {
            font-size: 3rem;
            margin-bottom: 10px;
        }
        
        h1 {
            font-size: 2rem;
            background: linear-gradient(135deg, #10b981, #06b6d4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }
        
        .tagline {
            color: #888;
            font-size: 1rem;
        }
        
        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            color: #888;
            text-decoration: none;
            font-size: 0.9rem;
        }
        
        .back-link:hover {
            color: #10b981;
        }
        
        /* Wallet Connect */
        .wallet-section {
            background: linear-gradient(135deg, #12121a 0%, #1a1a2e 100%);
            border: 2px solid #10b981;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .wallet-section.connected {
            border-color: #10b981;
            background: linear-gradient(135deg, #0a0f0a 0%, #0f1a0f 100%);
        }
        
        .connect-btn {
            background: linear-gradient(135deg, #10b981, #06b6d4);
            color: #000;
            border: none;
            padding: 15px 40px;
            font-size: 1.1rem;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .connect-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(16, 185, 129, 0.4);
        }
        
        .connect-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .wallet-address {
            font-family: monospace;
            color: #10b981;
            font-size: 1rem;
            margin-top: 10px;
        }
        
        .wallet-balance {
            color: #888;
            font-size: 0.9rem;
            margin-top: 5px;
        }
        
        /* Wallet Modal */
        .wallet-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(4px);
        }
        
        .wallet-modal-overlay.visible {
            display: flex;
        }
        
        .wallet-modal {
            background: #12121a;
            border: 1px solid #1a1a2e;
            border-radius: 16px;
            padding: 30px;
            max-width: 420px;
            width: 90%;
            animation: modalSlide 0.3s ease;
        }
        
        @keyframes modalSlide {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .wallet-modal h3 {
            color: #fff;
            margin-bottom: 8px;
            font-size: 1.3rem;
        }
        
        .wallet-modal p {
            color: #888;
            margin-bottom: 24px;
            font-size: 0.9rem;
        }
        
        .wallet-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .wallet-option {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: #0a0a0f;
            border: 1px solid #1a1a2e;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .wallet-option:hover {
            border-color: #10b981;
            background: #0f1a0f;
            transform: translateX(4px);
        }
        
        .wallet-option.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .wallet-option.disabled:hover {
            border-color: #1a1a2e;
            background: #0a0a0f;
            transform: none;
        }
        
        .wallet-icon {
            width: 44px;
            height: 44px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            flex-shrink: 0;
        }
        
        .wallet-icon.metamask {
            background: linear-gradient(135deg, #f6851b, #e2761b);
        }
        
        .wallet-icon.coinbase {
            background: linear-gradient(135deg, #0052ff, #0040cc);
        }
        
        .wallet-icon.trust {
            background: linear-gradient(135deg, #3375bb, #285a94);
        }
        
        .wallet-icon.rainbow {
            background: linear-gradient(135deg, #ff5a5f, #ff9500, #ffcc00, #34c759, #5ac8fa, #af52de, #ff2d55);
        }
        
        .wallet-info {
            flex: 1;
        }
        
        .wallet-name {
            color: #fff;
            font-weight: 600;
            font-size: 1rem;
        }
        
        .wallet-desc {
            color: #666;
            font-size: 0.8rem;
            margin-top: 2px;
        }
        
        .wallet-arrow {
            color: #333;
            font-size: 1.2rem;
        }
        
        .wallet-option:hover .wallet-arrow {
            color: #10b981;
        }
        
        .modal-close {
            display: block;
            width: 100%;
            margin-top: 20px;
            padding: 12px;
            background: transparent;
            border: 1px solid #333;
            color: #888;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }
        
        .modal-close:hover {
            border-color: #666;
            color: #fff;
        }
        
        .connected-wallet-info {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-top: 15px;
        }
        
        .connected-wallet-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }
        
        .disconnect-btn {
            background: transparent;
            border: 1px solid #333;
            color: #888;
            padding: 6px 12px;
            font-size: 0.8rem;
            border-radius: 6px;
            cursor: pointer;
            margin-left: 10px;
        }
        
        .disconnect-btn:hover {
            border-color: #ef4444;
            color: #ef4444;
        }
        
        /* Deposit Interface */
        .deposit-section {
            background: #12121a;
            border: 1px solid #1a1a2e;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            display: none;
        }
        
        .deposit-section.visible {
            display: block;
        }
        
        .deposit-section h3 {
            color: #fff;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            color: #888;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }
        
        .input-row {
            display: flex;
            gap: 10px;
        }
        
        .input-group input {
            flex: 1;
            background: #0a0a0f;
            border: 1px solid #333;
            color: #fff;
            padding: 15px;
            font-size: 1.1rem;
            border-radius: 8px;
            font-family: monospace;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #10b981;
        }
        
        .max-btn {
            background: #1a1a2e;
            border: 1px solid #333;
            color: #10b981;
            padding: 15px 20px;
            font-size: 0.9rem;
            border-radius: 8px;
            cursor: pointer;
        }
        
        .max-btn:hover {
            background: #252535;
        }
        
        .action-btns {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .action-btn {
            flex: 1;
            min-width: 150px;
            padding: 15px 25px;
            font-size: 1rem;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }
        
        .approve-btn {
            background: #f59e0b;
            color: #000;
        }
        
        .approve-btn:hover:not(:disabled) {
            background: #fbbf24;
        }
        
        .deposit-btn {
            background: #10b981;
            color: #000;
        }
        
        .deposit-btn:hover:not(:disabled) {
            background: #34d399;
        }
        
        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .status-message {
            margin-top: 15px;
            padding: 12px;
            border-radius: 8px;
            font-size: 0.9rem;
            display: none;
        }
        
        .status-message.visible {
            display: block;
        }
        
        .status-message.info {
            background: #06b6d433;
            border: 1px solid #06b6d4;
            color: #06b6d4;
        }
        
        .status-message.success {
            background: #10b98133;
            border: 1px solid #10b981;
            color: #10b981;
        }
        
        .status-message.error {
            background: #ef444433;
            border: 1px solid #ef4444;
            color: #ef4444;
        }
        
        .allowance-info {
            color: #888;
            font-size: 0.85rem;
            margin-top: 10px;
        }
        
        .allowance-info .approved {
            color: #10b981;
        }
        
        /* Terminal Styles */
        .terminal {
            background: #0d0d12;
            border: 1px solid #1a1a2e;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 30px;
        }
        
        .terminal-header {
            background: #12121a;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            border-bottom: 1px solid #1a1a2e;
        }
        
        .terminal-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .terminal-dot.red { background: #ff5f56; }
        .terminal-dot.yellow { background: #ffbd2e; }
        .terminal-dot.green { background: #27ca40; }
        
        .terminal-title {
            margin-left: 10px;
            color: #666;
            font-size: 0.85rem;
            font-family: monospace;
        }
        
        .terminal-body {
            padding: 20px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.9rem;
            min-height: 300px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .terminal-line {
            margin-bottom: 8px;
            display: flex;
            flex-wrap: wrap;
        }
        
        .prompt {
            color: #10b981;
            margin-right: 8px;
        }
        
        .command {
            color: #06b6d4;
        }
        
        .output {
            color: #9ca3af;
            padding-left: 20px;
            width: 100%;
        }
        
        .output.success { color: #10b981; }
        .output.error { color: #ef4444; }
        .output.warning { color: #f59e0b; }
        .output.highlight { color: #8b5cf6; }
        .output.info { color: #06b6d4; }
        .divider { color: #333; padding-left: 0; }
        
        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: #12121a;
            border: 1px solid #1a1a2e;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }
        
        .stat-card.locked {
            border-color: #10b981;
            background: linear-gradient(135deg, #0a0a0f 0%, #0f1a0f 100%);
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #10b981;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.85rem;
            color: #666;
            text-transform: uppercase;
        }
        
        /* Contract Info */
        .contract-info {
            background: #12121a;
            border: 1px solid #1a1a2e;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .contract-info h3 {
            color: #fff;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #1a1a2e;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .info-row:last-child {
            border-bottom: none;
        }
        
        .info-label {
            color: #888;
        }
        
        .info-value {
            color: #e0e0e0;
            font-family: monospace;
            word-break: break-all;
        }
        
        .info-value a {
            color: #10b981;
            text-decoration: none;
        }
        
        .info-value a:hover {
            text-decoration: underline;
        }
        
        /* Deposits Table */
        .deposits-section {
            background: #12121a;
            border: 1px solid #1a1a2e;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .deposits-section h3 {
            color: #fff;
            margin-bottom: 20px;
        }
        
        .deposits-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .deposits-table th {
            text-align: left;
            padding: 12px;
            color: #888;
            font-weight: normal;
            font-size: 0.85rem;
            text-transform: uppercase;
            border-bottom: 1px solid #1a1a2e;
        }
        
        .deposits-table td {
            padding: 12px;
            border-bottom: 1px solid #1a1a2e;
            font-family: monospace;
            font-size: 0.85rem;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: bold;
        }
        
        .status-badge.locked {
            background: #10b98133;
            color: #10b981;
        }
        
        .status-badge.unlocked {
            background: #f59e0b33;
            color: #f59e0b;
        }
        
        .no-deposits {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        footer {
            text-align: center;
            padding: 40px 20px;
            border-top: 1px solid #1a1a2e;
            color: #666;
            font-size: 0.9rem;
        }
        
        footer a {
            color: #10b981;
            text-decoration: none;
        }
        
        .loading {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #888;
        }
        
        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #333;
            border-top-color: #10b981;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        @media (max-width: 600px) {
            h1 { font-size: 1.5rem; }
            .terminal-body { font-size: 0.8rem; }
            .stat-value { font-size: 1.4rem; }
            .action-btns { flex-direction: column; }
            .wallet-modal { padding: 20px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">‚Üê Back to Bureau</a>
        
        <header>
            <div class="logo">üîí</div>
            <h1>BAI Vesting Terminal</h1>
            <p class="tagline">2-Year Token Lockup ‚Ä¢ Community Trust Mechanism</p>
        </header>
        
        <!-- Wallet Connect Section -->
        <div class="wallet-section" id="wallet-section">
            <h3 style="color: #fff; margin-bottom: 15px;">üîó Connect Wallet to Deposit</h3>
            <button class="connect-btn" id="connect-btn" onclick="openWalletModal()">
                Connect Wallet
            </button>
            <div id="connected-info" style="display: none;">
                <div class="connected-wallet-info">
                    <div class="connected-wallet-icon" id="connected-wallet-icon">ü¶ä</div>
                    <div>
                        <div class="wallet-address" id="wallet-address"></div>
                        <div class="wallet-balance" id="wallet-balance"></div>
                    </div>
                    <button class="disconnect-btn" onclick="disconnectWallet()">Disconnect</button>
                </div>
            </div>
        </div>
        
        <!-- Wallet Selection Modal -->
        <div class="wallet-modal-overlay" id="wallet-modal">
            <div class="wallet-modal">
                <h3>Connect Wallet</h3>
                <p>Choose your preferred wallet to connect to the BAI Vesting Terminal</p>
                
                <div class="wallet-options">
                    <div class="wallet-option" onclick="connectWithWallet('metamask')">
                        <div class="wallet-icon metamask">ü¶ä</div>
                        <div class="wallet-info">
                            <div class="wallet-name">MetaMask</div>
                            <div class="wallet-desc">Connect using browser extension</div>
                        </div>
                        <div class="wallet-arrow">‚Üí</div>
                    </div>
                    
                    <div class="wallet-option" onclick="connectWithWallet('coinbase')">
                        <div class="wallet-icon coinbase">üí∞</div>
                        <div class="wallet-info">
                            <div class="wallet-name">Coinbase Wallet</div>
                            <div class="wallet-desc">Connect using Coinbase Wallet</div>
                        </div>
                        <div class="wallet-arrow">‚Üí</div>
                    </div>
                    
                    <div class="wallet-option" onclick="connectWithWallet('trust')">
                        <div class="wallet-icon trust">üõ°Ô∏è</div>
                        <div class="wallet-info">
                            <div class="wallet-name">Trust Wallet</div>
                            <div class="wallet-desc">Connect via WalletConnect</div>
                        </div>
                        <div class="wallet-arrow">‚Üí</div>
                    </div>
                    
                    <div class="wallet-option" onclick="connectWithWallet('rainbow')">
                        <div class="wallet-icon rainbow">üåà</div>
                        <div class="wallet-info">
                            <div class="wallet-name">Rainbow</div>
                            <div class="wallet-desc">Connect via WalletConnect</div>
                        </div>
                        <div class="wallet-arrow">‚Üí</div>
                    </div>
                </div>
                
                <button class="modal-close" onclick="closeWalletModal()">Cancel</button>
            </div>
        </div>
        
        <!-- Deposit Interface (shown after connect) -->
        <div class="deposit-section" id="deposit-section">
            <h3>üí∞ Deposit testBAI</h3>
            <div class="input-group">
                <label>Amount to Lock (2-year vesting period)</label>
                <div class="input-row">
                    <input type="number" id="deposit-amount" placeholder="0.0" min="0" step="any">
                    <button class="max-btn" onclick="setMaxAmount()">MAX</button>
                </div>
                <div class="allowance-info" id="allowance-info">
                    Allowance: <span id="current-allowance">Checking...</span>
                </div>
            </div>
            <div class="action-btns">
                <button class="action-btn approve-btn" id="approve-btn" onclick="approveTokens()">
                    1. Approve testBAI
                </button>
                <button class="action-btn deposit-btn" id="deposit-btn" onclick="depositTokens()" disabled>
                    2. Deposit & Lock
                </button>
            </div>
            <div class="status-message" id="status-message"></div>
        </div>
        
        <!-- Stats Cards -->
        <div class="stats-grid">
            <div class="stat-card locked">
                <div class="stat-value" id="total-locked">-</div>
                <div class="stat-label">testBAI Locked</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="deposit-count">-</div>
                <div class="stat-label">Total Deposits</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">730</div>
                <div class="stat-label">Days Lock Period</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="unique-depositors">-</div>
                <div class="stat-label">Unique Depositors</div>
            </div>
        </div>
        
        <!-- Terminal -->
        <div class="terminal">
            <div class="terminal-header">
                <div class="terminal-dot red"></div>
                <div class="terminal-dot yellow"></div>
                <div class="terminal-dot green"></div>
                <span class="terminal-title">bai-vesting-v2 ‚Äî base:mainnet</span>
            </div>
            <div class="terminal-body" id="terminal-output">
                <div class="terminal-line">
                    <span class="prompt">$</span>
                    <span class="command">vesting status --contract 0xfC59...0988</span>
                </div>
                <div class="terminal-line">
                    <span class="output">Connecting to Base mainnet...</span>
                </div>
            </div>
        </div>
        
        <!-- Contract Info -->
        <div class="contract-info">
            <h3>üìú Contract Details</h3>
            <div class="info-row">
                <span class="info-label">Contract Address</span>
                <span class="info-value">
                    <a href="https://basescan.org/address/0xfC5944055F1877320fc87feFCE0F845C507B0988" target="_blank">
                        0xfC5944055F1877320fc87feFCE0F845C507B0988
                    </a>
                </span>
            </div>
            <div class="info-row">
                <span class="info-label">Token</span>
                <span class="info-value">
                    <a href="https://basescan.org/token/0x2ca8b2b97bc0f0ccdd875dcfeff16b868a1b5ba3" target="_blank">
                        testBAI (0x2ca8...5ba3)
                    </a>
                </span>
            </div>
            <div class="info-row">
                <span class="info-label">Network</span>
                <span class="info-value">Base Mainnet (Chain ID: 8453)</span>
            </div>
            <div class="info-row">
                <span class="info-label">Lock Duration</span>
                <span class="info-value">730 days (2 years)</span>
            </div>
            <div class="info-row">
                <span class="info-label">Verification</span>
                <span class="info-value">
                    <a href="https://basescan.org/address/0xfC5944055F1877320fc87feFCE0F845C507B0988#code" target="_blank">BaseScan ‚úì</a>
                    &nbsp;|&nbsp;
                    <a href="https://sourcify.dev/#/lookup/0xfC5944055F1877320fc87feFCE0F845C507B0988" target="_blank">Sourcify ‚úì</a>
                </span>
            </div>
        </div>
        
        <!-- Recent Deposits -->
        <div class="deposits-section">
            <h3>üìã Recent Deposits</h3>
            <div id="deposits-container">
                <div class="loading">
                    <div class="spinner"></div>
                    <span>Loading deposits from blockchain...</span>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Bureau of Agent Investigations ‚Äî Trust Infrastructure for the Agent Economy üèõÔ∏è</p>
            <p style="margin-top: 10px;">
                <a href="index.html">Home</a> ‚Ä¢ 
                <a href="https://basescan.org/address/0xfC5944055F1877320fc87feFCE0F845C507B0988" target="_blank">View Contract</a> ‚Ä¢
                <a href="https://github.com/simpleonbase-commits/BAI-V.0.0.01/tree/main/vesting-v2" target="_blank">GitHub</a>
            </p>
        </footer>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <script src="https://unpkg.com/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>
    <script>
        const CONTRACT_ADDRESS = '0xfC5944055F1877320fc87feFCE0F845C507B0988';
        const TOKEN_ADDRESS = '0x2ca8b2b97bc0f0ccdd875dcfeff16b868a1b5ba3';
        const RPC_URL = 'https://mainnet.base.org';
        const BASE_CHAIN_ID = 8453;
        const WALLETCONNECT_PROJECT_ID = '3c534a8c570db2c5c33db7e8a0c0d7a4'; // Public demo project ID
        
        // Fixed ABI to match BAIVesting.sol contract
        const VESTING_ABI = [
            "function vestingToken() view returns (address)",
            "function VESTING_DURATION() view returns (uint256)",
            "function getDepositCount(address) view returns (uint256)",
            "function deposits(address, uint256) view returns (uint256 amount, uint256 depositTime, uint256 unlockTime, bool withdrawn, string memo)",
            "function depositSelf(uint256 amount, string memo)",
            "function withdraw(uint256 depositId)",
            "function withdrawAll() returns (uint256)",
            "function getDeposit(address, uint256) view returns (uint256 amount, uint256 depositTime, uint256 unlockTime, bool withdrawn, string memo)",
            "function getUnlockedBalance(address) view returns (uint256)",
            "function getLockedBalance(address) view returns (uint256)",
            "function getAllDeposits(address) view returns (uint256[] amounts, uint256[] depositTimes, uint256[] unlockTimes, bool[] withdrawnFlags)",
            "function totalVested() view returns (uint256)",
            "function totalDepositCount() view returns (uint256)",
            "event TokensDeposited(address indexed beneficiary, uint256 indexed depositId, uint256 amount, uint256 depositTime, uint256 unlockTime, string memo)",
            "event TokensWithdrawn(address indexed beneficiary, uint256 indexed depositId, uint256 amount, uint256 withdrawTime)"
        ];
        
        const ERC20_ABI = [
            "function balanceOf(address) view returns (uint256)",
            "function decimals() view returns (uint8)",
            "function symbol() view returns (string)",
            "function allowance(address owner, address spender) view returns (uint256)",
            "function approve(address spender, uint256 amount) returns (bool)"
        ];
        
        let provider;
        let signer;
        let vestingContract;
        let tokenContract;
        let userAddress;
        let userBalance = 0;
        let currentAllowance = 0;
        let connectedWalletType = null;
        let walletConnectProvider = null;
        
        const terminal = document.getElementById('terminal-output');
        
        const walletIcons = {
            metamask: 'ü¶ä',
            coinbase: 'üí∞',
            trust: 'üõ°Ô∏è',
            rainbow: 'üåà'
        };
        
        const walletColors = {
            metamask: 'linear-gradient(135deg, #f6851b, #e2761b)',
            coinbase: 'linear-gradient(135deg, #0052ff, #0040cc)',
            trust: 'linear-gradient(135deg, #3375bb, #285a94)',
            rainbow: 'linear-gradient(135deg, #ff5a5f, #ff9500, #ffcc00, #34c759, #5ac8fa, #af52de, #ff2d55)'
        };
        
        function openWalletModal() {
            document.getElementById('wallet-modal').classList.add('visible');
        }
        
        function closeWalletModal() {
            document.getElementById('wallet-modal').classList.remove('visible');
        }
        
        function addTerminalLine(text, type = '') {
            const line = document.createElement('div');
            line.className = 'terminal-line';
            line.innerHTML = `<span class="output ${type}">${text}</span>`;
            terminal.appendChild(line);
            terminal.scrollTop = terminal.scrollHeight;
        }
        
        function addDivider() {
            addTerminalLine('‚îÄ'.repeat(50), 'divider');
        }
        
        function formatNumber(num, decimals = 2) {
            return new Intl.NumberFormat('en-US', {
                minimumFractionDigits: decimals,
                maximumFractionDigits: decimals
            }).format(num);
        }
        
        function formatDate(timestamp) {
            return new Date(timestamp * 1000).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        function formatTimeRemaining(unlockTime) {
            const now = Math.floor(Date.now() / 1000);
            const remaining = unlockTime - now;
            
            if (remaining <= 0) return 'UNLOCKED';
            
            const days = Math.floor(remaining / 86400);
            const hours = Math.floor((remaining % 86400) / 3600);
            
            if (days > 0) {
                return `${days}d ${hours}h`;
            }
            return `${hours}h`;
        }
        
        function showStatus(message, type = 'info') {
            const statusEl = document.getElementById('status-message');
            statusEl.textContent = message;
            statusEl.className = `status-message visible ${type}`;
        }
        
        function hideStatus() {
            document.getElementById('status-message').className = 'status-message';
        }
        
        async function connectWithWallet(walletType) {
            closeWalletModal();
            
            const btn = document.getElementById('connect-btn');
            btn.textContent = 'Connecting...';
            btn.disabled = true;
            
            try {
                if (walletType === 'metamask') {
                    await connectMetaMask();
                } else if (walletType === 'coinbase') {
                    await connectCoinbase();
                } else if (walletType === 'trust' || walletType === 'rainbow') {
                    await connectWalletConnect(walletType);
                }
                
                connectedWalletType = walletType;
                await onWalletConnected();
                
            } catch (error) {
                console.error(error);
                btn.textContent = 'Connect Wallet';
                btn.disabled = false;
                
                if (error.message.includes('not found') || error.message.includes('not installed')) {
                    alert(error.message);
                } else {
                    alert('Failed to connect: ' + error.message);
                }
            }
        }
        
        async function connectMetaMask() {
            if (typeof window.ethereum === 'undefined' || !window.ethereum.isMetaMask) {
                // Check if there's any injected provider
                if (typeof window.ethereum === 'undefined') {
                    throw new Error('MetaMask not found! Please install MetaMask browser extension.');
                }
            }
            
            // Request account access
            const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
            userAddress = accounts[0];
            
            // Switch to Base network if needed
            await switchToBase(window.ethereum);
            
            // Setup ethers with signer
            provider = new ethers.providers.Web3Provider(window.ethereum);
            signer = provider.getSigner();
            
            // Listen for account changes
            window.ethereum.on('accountsChanged', handleAccountChange);
            window.ethereum.on('chainChanged', () => location.reload());
        }
        
        async function connectCoinbase() {
            // Coinbase Wallet injects as window.ethereum with isCoinbaseWallet flag
            // Or as window.coinbaseWalletExtension
            let coinbaseProvider = null;
            
            if (window.coinbaseWalletExtension) {
                coinbaseProvider = window.coinbaseWalletExtension;
            } else if (window.ethereum?.isCoinbaseWallet) {
                coinbaseProvider = window.ethereum;
            } else if (window.ethereum?.providers) {
                // Multiple wallets installed - find Coinbase
                coinbaseProvider = window.ethereum.providers.find(p => p.isCoinbaseWallet);
            }
            
            if (!coinbaseProvider) {
                throw new Error('Coinbase Wallet not found! Please install Coinbase Wallet browser extension.');
            }
            
            const accounts = await coinbaseProvider.request({ method: 'eth_requestAccounts' });
            userAddress = accounts[0];
            
            await switchToBase(coinbaseProvider);
            
            provider = new ethers.providers.Web3Provider(coinbaseProvider);
            signer = provider.getSigner();
            
            coinbaseProvider.on('accountsChanged', handleAccountChange);
            coinbaseProvider.on('chainChanged', () => location.reload());
        }
        
        async function connectWalletConnect(walletType) {
            // Use WalletConnect for Trust Wallet and Rainbow
            // They connect via QR code or deep link on mobile
            
            try {
                walletConnectProvider = new WalletConnectProvider.default({
                    rpc: {
                        8453: RPC_URL
                    },
                    chainId: BASE_CHAIN_ID,
                    qrcode: true,
                    qrcodeModalOptions: {
                        mobileLinks: walletType === 'trust' 
                            ? ['trust'] 
                            : ['rainbow']
                    }
                });
                
                // Enable session (triggers QR modal)
                await walletConnectProvider.enable();
                
                userAddress = walletConnectProvider.accounts[0];
                
                provider = new ethers.providers.Web3Provider(walletConnectProvider);
                signer = provider.getSigner();
                
                // Subscribe to events
                walletConnectProvider.on('accountsChanged', handleAccountChange);
                walletConnectProvider.on('chainChanged', () => location.reload());
                walletConnectProvider.on('disconnect', disconnectWallet);
                
            } catch (error) {
                if (error.message.includes('User closed')) {
                    throw new Error('Connection cancelled by user');
                }
                throw error;
            }
        }
        
        async function switchToBase(ethereumProvider) {
            const chainId = await ethereumProvider.request({ method: 'eth_chainId' });
            if (parseInt(chainId, 16) !== BASE_CHAIN_ID) {
                try {
                    await ethereumProvider.request({
                        method: 'wallet_switchEthereumChain',
                        params: [{ chainId: '0x2105' }],
                    });
                } catch (switchError) {
                    if (switchError.code === 4902) {
                        await ethereumProvider.request({
                            method: 'wallet_addEthereumChain',
                            params: [{
                                chainId: '0x2105',
                                chainName: 'Base',
                                nativeCurrency: { name: 'ETH', symbol: 'ETH', decimals: 18 },
                                rpcUrls: ['https://mainnet.base.org'],
                                blockExplorerUrls: ['https://basescan.org']
                            }],
                        });
                    } else {
                        throw switchError;
                    }
                }
            }
        }
        
        function handleAccountChange(accounts) {
            if (accounts.length === 0) {
                disconnectWallet();
            } else {
                location.reload();
            }
        }
        
        async function disconnectWallet() {
            if (walletConnectProvider) {
                await walletConnectProvider.disconnect();
                walletConnectProvider = null;
            }
            
            userAddress = null;
            connectedWalletType = null;
            provider = null;
            signer = null;
            
            // Reset UI
            document.getElementById('wallet-section').classList.remove('connected');
            document.getElementById('connect-btn').textContent = 'Connect Wallet';
            document.getElementById('connect-btn').disabled = false;
            document.getElementById('connect-btn').style.display = 'inline-block';
            document.getElementById('connected-info').style.display = 'none';
            document.getElementById('deposit-section').classList.remove('visible');
            
            addTerminalLine('Wallet disconnected', 'warning');
        }
        
        async function onWalletConnected() {
            vestingContract = new ethers.Contract(CONTRACT_ADDRESS, VESTING_ABI, signer);
            tokenContract = new ethers.Contract(TOKEN_ADDRESS, ERC20_ABI, signer);
            
            // Update UI
            document.getElementById('wallet-section').classList.add('connected');
            document.getElementById('connect-btn').style.display = 'none';
            document.getElementById('connected-info').style.display = 'block';
            
            const icon = document.getElementById('connected-wallet-icon');
            icon.textContent = walletIcons[connectedWalletType];
            icon.style.background = walletColors[connectedWalletType];
            
            const shortAddress = `${userAddress.slice(0, 6)}...${userAddress.slice(-4)}`;
            document.getElementById('wallet-address').textContent = `Connected: ${shortAddress}`;
            
            // Get balance
            const balance = await tokenContract.balanceOf(userAddress);
            const decimals = await tokenContract.decimals();
            userBalance = parseFloat(ethers.utils.formatUnits(balance, decimals));
            document.getElementById('wallet-balance').textContent = `Balance: ${formatNumber(userBalance)} testBAI`;
            
            // Check allowance
            await checkAllowance();
            
            // Show deposit section
            document.getElementById('deposit-section').classList.add('visible');
            
            addTerminalLine(`‚úì Wallet connected: ${shortAddress} (${connectedWalletType})`, 'success');
            addTerminalLine(`Balance: ${formatNumber(userBalance)} testBAI`, 'info');
        }
        
        async function checkAllowance() {
            try {
                const allowance = await tokenContract.allowance(userAddress, CONTRACT_ADDRESS);
                const decimals = await tokenContract.decimals();
                currentAllowance = parseFloat(ethers.utils.formatUnits(allowance, decimals));
                
                const allowanceEl = document.getElementById('current-allowance');
                if (currentAllowance > 1000000000) {
                    allowanceEl.innerHTML = '<span class="approved">Unlimited ‚úì</span>';
                    document.getElementById('approve-btn').textContent = '1. Approved ‚úì';
                    document.getElementById('approve-btn').disabled = true;
                    document.getElementById('deposit-btn').disabled = false;
                } else if (currentAllowance > 0) {
                    allowanceEl.innerHTML = `<span class="approved">${formatNumber(currentAllowance)} testBAI ‚úì</span>`;
                    document.getElementById('deposit-btn').disabled = false;
                } else {
                    allowanceEl.textContent = '0 (approval needed)';
                }
            } catch (error) {
                console.error('Allowance check error:', error);
            }
        }
        
        function setMaxAmount() {
            document.getElementById('deposit-amount').value = userBalance;
        }
        
        async function approveTokens() {
            try {
                const btn = document.getElementById('approve-btn');
                btn.textContent = 'Approving...';
                btn.disabled = true;
                showStatus('Please confirm the approval in your wallet...', 'info');
                
                // Approve max uint256
                const maxUint = ethers.constants.MaxUint256;
                const tx = await tokenContract.approve(CONTRACT_ADDRESS, maxUint);
                
                showStatus('Waiting for transaction confirmation...', 'info');
                addTerminalLine(`Approval TX submitted: ${tx.hash.slice(0, 10)}...`, 'info');
                
                await tx.wait();
                
                showStatus('Approval successful! You can now deposit.', 'success');
                addTerminalLine('‚úì Approval confirmed!', 'success');
                
                btn.textContent = '1. Approved ‚úì';
                document.getElementById('deposit-btn').disabled = false;
                await checkAllowance();
                
            } catch (error) {
                console.error(error);
                showStatus('Approval failed: ' + error.message, 'error');
                document.getElementById('approve-btn').textContent = '1. Approve testBAI';
                document.getElementById('approve-btn').disabled = false;
            }
        }
        
        async function depositTokens() {
            try {
                const amount = parseFloat(document.getElementById('deposit-amount').value);
                if (!amount || amount <= 0) {
                    showStatus('Please enter a valid amount', 'error');
                    return;
                }
                
                if (amount > userBalance) {
                    showStatus('Insufficient balance', 'error');
                    return;
                }
                
                const btn = document.getElementById('deposit-btn');
                btn.textContent = 'Depositing...';
                btn.disabled = true;
                showStatus('Please confirm the deposit in your wallet...', 'info');
                
                const decimals = await tokenContract.decimals();
                const amountWei = ethers.utils.parseUnits(amount.toString(), decimals);
                
                // Fixed: use depositSelf with memo parameter
                const tx = await vestingContract.depositSelf(amountWei, "");
                
                showStatus('Waiting for transaction confirmation...', 'info');
                addTerminalLine(`Deposit TX submitted: ${tx.hash.slice(0, 10)}...`, 'info');
                
                await tx.wait();
                
                const unlockDate = new Date(Date.now() + (730 * 24 * 60 * 60 * 1000));
                showStatus(`‚úì Successfully locked ${formatNumber(amount)} testBAI until ${unlockDate.toLocaleDateString()}!`, 'success');
                addTerminalLine(`‚úì Deposited ${formatNumber(amount)} testBAI (locked for 2 years)`, 'success');
                
                // Refresh data
                btn.textContent = '2. Deposit & Lock';
                btn.disabled = false;
                document.getElementById('deposit-amount').value = '';
                
                // Update balance
                const newBalance = await tokenContract.balanceOf(userAddress);
                userBalance = parseFloat(ethers.utils.formatUnits(newBalance, decimals));
                document.getElementById('wallet-balance').textContent = `Balance: ${formatNumber(userBalance)} testBAI`;
                
                // Refresh deposits display
                await init();
                
            } catch (error) {
                console.error(error);
                showStatus('Deposit failed: ' + error.message, 'error');
                document.getElementById('deposit-btn').textContent = '2. Deposit & Lock';
                document.getElementById('deposit-btn').disabled = false;
            }
        }
        
        async function init() {
            try {
                addTerminalLine('Initializing connection...', 'info');
                
                const readProvider = new ethers.providers.JsonRpcProvider(RPC_URL);
                const readVesting = new ethers.Contract(CONTRACT_ADDRESS, VESTING_ABI, readProvider);
                const readToken = new ethers.Contract(TOKEN_ADDRESS, ERC20_ABI, readProvider);
                
                addTerminalLine('‚úì Connected to Base mainnet', 'success');
                addDivider();
                
                // Get token info
                const symbol = await readToken.symbol();
                const decimals = await readToken.decimals();
                const contractBalance = await readToken.balanceOf(CONTRACT_ADDRESS);
                const formattedBalance = ethers.utils.formatUnits(contractBalance, decimals);
                
                addTerminalLine(`Token: ${symbol}`, 'info');
                addTerminalLine(`Contract Balance: ${formatNumber(parseFloat(formattedBalance))} ${symbol}`, 'highlight');
                
                document.getElementById('total-locked').textContent = formatNumber(parseFloat(formattedBalance));
                
                // Fixed: use VESTING_DURATION instead of LOCK_DURATION
                const lockDuration = await readVesting.VESTING_DURATION();
                const lockDays = lockDuration.toNumber() / 86400;
                addTerminalLine(`Lock Duration: ${lockDays} days`, 'info');
                
                addDivider();
                
                // Fetch deposit events
                addTerminalLine('Fetching deposit events...', 'info');
                
                // Fixed: event signature matches contract
                const depositFilter = readVesting.filters.TokensDeposited();
                const events = await readVesting.queryFilter(depositFilter, -100000);
                
                addTerminalLine(`‚úì Found ${events.length} deposit event(s)`, 'success');
                
                document.getElementById('deposit-count').textContent = events.length;
                
                // Fixed: event args use 'beneficiary' not 'depositor'
                const uniqueDepositors = new Set(events.map(e => e.args.beneficiary));
                document.getElementById('unique-depositors').textContent = uniqueDepositors.size;
                
                addTerminalLine(`Unique Depositors: ${uniqueDepositors.size}`, 'info');
                
                addDivider();
                addTerminalLine('System Status: OPERATIONAL', 'success');
                addTerminalLine(`Last Updated: ${new Date().toLocaleString()}`, 'info');
                
                // Display deposits
                await displayDeposits(events, decimals, lockDuration.toNumber());
                
            } catch (error) {
                console.error(error);
                addTerminalLine(`Error: ${error.message}`, 'error');
                document.getElementById('deposits-container').innerHTML = `
                    <div class="no-deposits">
                        <p>‚ö†Ô∏è Unable to fetch data. Please try again later.</p>
                    </div>
                `;
            }
        }
        
        async function displayDeposits(events, decimals, lockDuration) {
            const container = document.getElementById('deposits-container');
            
            if (events.length === 0) {
                container.innerHTML = `
                    <div class="no-deposits">
                        <p>No deposits yet. Be the first to lock tokens! üîí</p>
                    </div>
                `;
                return;
            }
            
            // Sort by most recent first
            const sortedEvents = events.sort((a, b) => b.blockNumber - a.blockNumber);
            
            let tableHTML = `
                <table class="deposits-table">
                    <thead>
                        <tr>
                            <th>Depositor</th>
                            <th>Amount</th>
                            <th>Deposit Date</th>
                            <th>Unlock Date</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            for (const event of sortedEvents.slice(0, 20)) {
                // Fixed: use 'beneficiary' instead of 'depositor'
                const depositor = event.args.beneficiary;
                const amount = ethers.utils.formatUnits(event.args.amount, decimals);
                const depositTime = event.args.depositTime.toNumber();
                // Fixed: unlockTime is now directly available in event
                const unlockTime = event.args.unlockTime.toNumber();
                const now = Math.floor(Date.now() / 1000);
                const isUnlocked = now >= unlockTime;
                
                tableHTML += `
                    <tr>
                        <td>
                            <a href="https://basescan.org/address/${depositor}" target="_blank" style="color: #10b981;">
                                ${depositor.slice(0, 6)}...${depositor.slice(-4)}
                            </a>
                        </td>
                        <td>${formatNumber(parseFloat(amount))}</td>
                        <td>${formatDate(depositTime)}</td>
                        <td>${formatDate(unlockTime)}</td>
                        <td>
                            <span class="status-badge ${isUnlocked ? 'unlocked' : 'locked'}">
                                ${isUnlocked ? 'üîì Unlocked' : 'üîí ' + formatTimeRemaining(unlockTime)}
                            </span>
                        </td>
                    </tr>
                `;
            }
            
            tableHTML += `
                    </tbody>
                </table>
            `;
            
            if (events.length > 20) {
                tableHTML += `<p style="text-align: center; color: #666; margin-top: 15px; font-size: 0.85rem;">Showing 20 of ${events.length} deposits. <a href="https://basescan.org/address/${CONTRACT_ADDRESS}#events" target="_blank" style="color: #10b981;">View all on BaseScan ‚Üí</a></p>`;
            }
            
            container.innerHTML = tableHTML;
        }
        
        // Initialize on load
        window.addEventListener('load', init);
        
        // Auto-refresh every 60 seconds
        setInterval(init, 60000);
    </script>
</body>
</html>